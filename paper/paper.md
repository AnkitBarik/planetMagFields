---
title: >-
    planetMagFields: A Python package for analyzing and plotting planetary magnetic field data
authors:
  - name: Ankit Barik
    email: ankit.barik@gmail.com
    affiliation: 1
    orcid: 0000-0001-5747-669X
    corresponding: true
  - name: Regupathi Angappan
    email: rangapp1@jhu.edu
    affiliation: 1
    orcid: 0000-0002-6258-0659
affiliations:
  - index: 1
    name: Johns Hopkins University
date: 22 February 2024
bibliography: paper.bib
tags:
  - Python
  - planetary science
  - magnetic fields
  - visualization
---

# Summary
Long term observations and space missions have generated a wealth of data on the magnetic fields of the Earth and other solar system planets [@IGRF13;@Connerney1987;@Connerney1991;@Kivelson2002;@Anderson2012;@Cao2020;@Connerney2022]. `planetMagfields` is a Python package designed to have all the planetary magnetic field data currently available in one place and to provide an easy interface to access the data. `planetMagfields` focuses on planetary bodies that generate their own magnetic field, namely Mercury, Earth, Jupiter, Saturn, Uranus, Neptune and Ganymede. `planetMagfields` provides functions to compute as well as plot the magnetic field on the planetary surface or at a distance above or under the surface. It also provides functions to filter out the field to large or small scales as well as to produce `.vts` files to visualize the field in 3D using Paraview [@Ahrens2005;@Ayachit2015], VisIt [@visit] or similar rendering software. Lastly, the `planetMagfields` repository also provides a Jupyter notebook for easy interactive visualizations.

# Statement of need
Planetary scientists studying the magnetic field of planets need to constantly access, visualize, analyze and extrapolate magnetic field data.  In addition, with technological advancements in space exploration and planetary missions, we are constantly getting new data for planetary magnetic fields and hence, better field models. Though reviews of these field models are often written [@Schubert2011;@Stanley2014], there is very little software available that provides easy access to these models with a high level language and a way to easily visualize and analyze them. To the knowledge of the authors, there are a few publicly available repositories that are capable of providing access to planetary magnetic field data and tools to analyze them such as `JupiterMag` [@Wilson2023;@James2024], `KMAG` [@Khurana2020], `ChaosMagPy` [@Kloss2024], `SHTools` [@Wieczorek2018], `PlanetMag` [@Styczinski2024] and `libinteralfield` (<https://github.com/mattkjames7/libinternalfield>). Out of these, only `libinteralfield` provides data and software to analyze and access magnetic fields of all planets. However, it is a `C++` library which needs to be interfaced with something at a higher level to enable fast analyses and visualization.  Thus, a software package that has different magnetic field models for all different planets of the solar system in one place, as well as provides a high level API to access, analyze and visualize them is not available. `planetMagfields` is intended not only to currently fill this gap, but also to provide a central repository, to be constantly updated, as more magnetic field models become available.

In addition to the research aspect of our software, the interactive Jupyter notebook serves as a valuable educational resource, fostering a deeper appreciation for the complexities of planetary magnetic environments.

# Mathematics

Magnetic fields in planets are generated by electric currents in a fluid region inside them through a process called dynamo action [@Jones2011;@Schubert2011;@Stanley2014]. Outside this region, in the absence of current sources, the magnetic field $\vec{B}$ can be written as the gradient of a scalar potential, $\vec{B} = -\nabla V$. The potential $V$ is usually written as an expansion in orthogonal functions in spherical coordinates $(r,\theta,\phi)$,

\begin{equation}
  V = R_p \sum_{l,m} \left(\frac{R_p}{r}\right)^{l+1} [g_l^m \cos(m\phi) + h_l^m \sin(m\phi)] P_l^m (\cos\theta)\, ,
  \label{eq:gaussCoeff}
\end{equation}

where, $g_l^m$ and $h_l^m$ are called the Gauss coefficients. $R_p$ represents the radius of the planet and $P_l^m$ are associated Legendre functions of order $l$ and degree $m$, where $l$ and $m$ are integers. The above equation can be recast in terms of spherical harmonics, which is what the code uses.

The raw data obtained from satellites or space missions are usually inverted to obtain these Gauss coefficients which are the key to describing the surface magnetic field of a planet as well as how that field looks at a certain altitude from the surface. The magnetic energy content on the surface in a certain degree $l$ is given by the Lowes spectrum:

$$R_{l} = (l + 1) \sum_{m}\left( \left(g_l^m\right)^2 + \left(h_l^m\right)^2\right),$$

$l$ plays the role of a wavenumber. Low degrees represent large spatial features in the field while high degrees represent small scale features. The maximum available degree $l_{max}$ of data for a particular planet depends on the quality of observations.
<!--
For example, for Earth $l_{max} = 13$ because beyond that the magnetic field of magnetized rocks on the crust obscures any signal coming from the self generated field. Similarly, Jupiter's field was known only well constrained till $l_{max} = 4$ [@Connerney1998] before the Juno mission provided excellent observations of finer scale structure to extend the well constrained $l_{max}$ to 18 [@Connerney2022]. -->

# Benchmarking

We benchmarked our software against two publicly available repositories : `JupiterMag` [@Wilson2023;@James2024] for Jupiter and the `CHAOS-7` [@Finlay2020;@Kloss2024] for Earth. For Jupiter, we compare the field at a depth of 85\% of planetary radius, thus testing our extrapolation capability while for Earth, we compare the field on the surface in 2016, testing our implementation of taking into account changes in the Earth's field in a linear fashion [as is done for the IGRF model, @IGRF13]  The comparison for Jupiter is shown in Figure \ref{fig:bench}. We also use these cases in our unit testing.

\begin{figure}
\centering
\includegraphics[width=0.8\textwidth]{./figures/jup_bench.pdf}
\caption{Benchmarking the code against publicly available repositories.}
\label{fig:bench}
\end{figure}

# Description of the software

## The software package

`planetMagfields` has data files containing Gauss coefficients from various inversion studies of planetary magnetic models for different planets. These coefficients are then used to obtain the magnetic field on a grid of latitude and longitude using equation \eqref{eq:gaussCoeff}. The main way of accessing the data is through the ``Planet`` class. An example is provided below using IPython [@ipython],

  ```python
   In [1]: from planetmagfields import *

   In [2]: p = Planet(name='jupiter',model='jrm09')
   Planet: Jupiter
   Model: jrm09
   l_max = 10
   Dipole tilt (degrees) = 10.307870

   In [3]: p.plot(r=0.85,proj='Mollweide')
  ```
\begin{figure}
  \centering
  \includegraphics[width=0.5\textwidth]{figures/jupiter_r085.png}
  \caption[]{Plotting example of Jupiter's radial magnetic field at a depth of 85\% of the planetary radius.}
  \label{fig:jup85}
\end{figure}

The last plot statement produces Figure \ref{fig:jup85} which is the radial magnetic field at 85\% of the planetary radius. This can be compared against Figure 1h of @Moore2018. ``planetMagfields`` primarily uses ``NumPy`` [@numpy], ``Matplotlib`` [@matplotlib] and ``SciPy`` [@scipy] for most of its analyses. Further support for various map projections is added through Cartopy [@cartopy]. ``planetMagfields`` also provides functions to extrapolate and obtain all components of the magnetic field at a certain depth or height through spherical harmonic transforms using the SHTns library [@shtns]. Finally, this extrapolation also allows one to visualize the field in 3D. To enable that, ``planetMagfields`` uses the ``PyEVTK`` library (<https://github.com/paulo-herrera/PyEVTK>) to write ``.vts`` files which can be visualized using software like Paraview or VisIt. An example for Jupiter is provided below in Figure \ref{fig:jup3d}. A full list of available features is provided in the documentation.

\begin{figure}
\centering
\includegraphics[width=0.5\textwidth]{figures/jupiter3d.png}
\caption{3D rendering of Jupiter's magnetic field using Paraview, using a vts file produced by planetMagfields.}
\label{fig:jup3d}
\end{figure}

## Magnetic field models used

`planetMagfields` currently supports the following magnetic field models:

 - *Mercury*  : @Anderson2012 , @Thebault2018, @Wardinski2019
 - *Earth*    : The International Geomagnetic Reference Field (IGRF) [@IGRF13]
 - *Jupiter*  : The VIP-4 model [@Connerney1998], JRM09 [@Connerney2018], JRM33 [@Connerney2022]
 - *Saturn*   : Cassini Saturn orbit insertion (SOI) [@Burton2009], Cassini11 [@Dougherty2018], Cassini11+ [@Cao2020]
 - *Uranus*   : @Connerney1987
 - *Neptune*  : @Connerney1991
 - *Ganymede* : @Kivelson2002

When new magnetic field models become available, either through newly available data or through reanalysis of existing observations, we will add them to the current repository, either ourselves or through a community effort of pull requests.

## Jupyter frontend

We provide a Jupyter notebook, along with a binder link ( <https://mybinder.org/v2/gh/AnkitBarik/planetMagFields/HEAD?labpath=%2FExploreFieldsInteractively.ipynb> ) that gives interactive access for visualizing the radial magnetic fields and the corresponding Lowes spectra at various depths, with different background color options.



# Documentation

The software has been documented using Sphinx (<https://www.sphinx-doc.org/>) and the documentation is available here: <https://ankitbarik.github.io/planetMagFields/>.

# Acknowledgements

We thank Thomas Gastine and Jonathan Aurnou for testing the package, reporting bugs and for feature suggestions. We also thank Maximilian Arthus Schanner for the `setup.py` script. We thank Pankaj K. Mishra and Marshall Styczinski for advising us to get the paper published in JOSS.

# References


